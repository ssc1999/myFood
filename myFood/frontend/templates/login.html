<!DOCTYPE html>
<html lang="en">

<head>
	<title>myFood</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="icon" type="image/png" href="../images/icons/favicon.ico" />

	<link rel="stylesheet" type="text/css" href="../vendor/bootstrap/css/bootstrap.min.css">

	<link rel="stylesheet" type="text/css"
		href="../fonts/font-awesome-4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="../vendor/animate/animate.css">

	<link rel="stylesheet" type="text/css" href="../vendor/css-hamburgers/hamburgers.min.css">

	<link rel="stylesheet" type="text/css" href="../vendor/select2/select2.min.css">

	<link rel="stylesheet" type="text/css" href="../css/util.css">
	<link rel="stylesheet" type="text/css" href="../css/main.css">

</head>

<body>

	<div class="limiter">
		<div class="container-login100">
			<h1>myFood</h1>
			<div class="wrap-login100">
				<div class="login100-pic js-tilt" data-tilt>
					<img src="../images/img-01.jpeg" alt="IMG">
				</div>

				<form class="login100-form validate-form">
					<span class="login100-form-title">
						Welcome back!
					</span>

					<div class="wrap-input100 validate-input" data-validate="Username is required"
						id="userBox">
						<input class="input100" type="text" name="text" placeholder="Username"
							id="username">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-envelope" aria-hidden="true"></i>
						</span>
					</div>

					<div class="wrap-input100 validate-input" data-validate="Password is required"
						id="passBox">
						<input class="input100" type="password" name="pass" id="password"
							placeholder="Password">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-lock" aria-hidden="true"></i>
						</span>
					</div>

					<div class="container-login100-form-btn">
						<button class="login100-form-btn" id="submit" type="button">
							Login
						</button>
					</div>

					<div class="text-center p-t-136">
						<a class="txt2" href="/register.html">
							Create your Account
							<i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
						</a>
					</div>
				</form>
				<div id="popup_container" class="popup-container">
					<div class="popup">
						<h4 id="resultH4"></h4>
						<p id="resultP"></p>
						<button id="close">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		const submit = document.getElementById('submit');
		const popup_container = document.getElementById('popup_container');
		const close = document.getElementById('close');

		close.addEventListener('click', () => {
			popup_container.classList.remove('show');
		});

		submit.addEventListener('click', () => {
			loginUser();
		});

		// popup_container.classList.add('show');

		async function loginUser() {
			console.log("loginUser")

			const username = document.getElementById("username").value;
			const password = document.getElementById("password").value;

			const result = await fetch("/api/login", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({
					username,
					password,
				})
			})

			const data = await result.json();

			console.log({ data });

			if (data.status === 'ok') {
				console.log("Got the token: ", data.token);
				localStorage.setItem("token", data.token);
				location.href = 'index.html';
			} else {
				const processErrorMessage = (error) => {
					switch (error.code) {
						case 1:
							return "Invalid username or password, please try again"
						default:
							return `Unknown error: ${error.code}. ${error.message}`
					}
				}

				const title = "Something went wrong"
				const paragraph = processErrorMessage(data.error)

				document.getElementById("resultH4").innerHTML = title
				document.getElementById("resultP").innerHTML = paragraph

				popup_container.classList.add('show');
			}

			// const processErrorMessage = ({ code, message }) => {
			// 	switch (code) {
			// 		case 1:
			// 			return "Invalid username. Please make sure your username doesn't contain any invalid characters like '?, !, <, >, @, #, $, %, *, ^, (, )'."
			// 		case 2:
			// 			return "Invalid password. Please make sure your password doesn't contain any invalid characters like '?, !, <, >, @, #, $, %, *, ^, (, )'."
			// 		case 3:
			// 			return "Password not long enough or doesn't include special characters."
			// 		case 4:
			// 			return "This user alredy exists. Please try to log in or use a different username."
			// 		default:
			// 			return `Unknown error: ${code}. ${message}`
			// 	}
			// }

			// const isOk = status === 'ok'
			// const title = isOk
			// 	? "Register completed successfully"
			// 	: "Something went wrong"

			// const paragraph = isOk
			// 	? "To finish the registration process you have to go back to the login page and enter your credentials."
			// 	: processErrorMessage(error)

			// document.getElementById("resultH4").innerHTML = title
			// document.getElementById("resultP").innerHTML = paragraph

			// popup_container.classList.add('show');
		}


	</script>
	<script src="../vendor/jquery/jquery-3.2.1.min.js"></script>

	<script src="../vendor/bootstrap/js/popper.js"></script>
	<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

	<script src="../vendor/select2/select2.min.js"></script>

	<script src="../vendor/tilt/tilt.jquery.min.js"></script>
	<script>
		$('.js-tilt').tilt({
			scale: 1.1
		})
	</script>

	<script src="../js/main.js"></script>

</body>

</html>